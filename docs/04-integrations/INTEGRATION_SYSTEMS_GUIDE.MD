# BUMBA Integration Systems Guide

## Overview

The BUMBA CLI provides **59+ integration files** across multiple categories, enabling seamless connectivity with external services, databases, DevOps tools, and communication platforms.

## Table of Contents
1. [Quick Start](#quick-start)
2. [Configuration](#configuration)
3. [Available Integrations](#available-integrations)
4. [Circuit Breaker & Resilience](#circuit-breaker--resilience)
5. [Usage Examples](#usage-examples)
6. [Testing](#testing)
7. [Troubleshooting](#troubleshooting)

## Quick Start

### 1. Install Dependencies
```bash
npm install
```

### 2. Install MCP Servers (Optional)
```bash
# Install Context MCP Server for enhanced context management
npm install -g @modelcontextprotocol/server-context

# Or use with npx
npx @modelcontextprotocol/server-context
```

### 3. Configure Claude Desktop for Context MCP
Add to `~/Library/Application Support/Claude/claude_desktop_config.json`:
```json
{
  "mcpServers": {
    "context": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-context"]
    }
  }
}
```

### 4. Configure Environment
```bash
cp .env.example .env
# Edit .env with your credentials

# For Context MCP:
CONTEXT_MCP_ENABLED=true
CONTEXT_MAX_SIZE=200000
CONTEXT_STORAGE_PATH=~/.bumba/context
```

### 5. Initialize Integration
```javascript
// Example with Context MCP
const { ContextMCPIntegration } = require('./src/core/integrations/context-mcp-integration');

const context = new ContextMCPIntegration();
await context.initialize();

// Example with Figma
const { FigmaIntegration } = require('./src/core/integrations/figma-integration');

const figma = new FigmaIntegration({
  accessToken: process.env.FIGMA_ACCESS_TOKEN
});

await figma.initialize();
```

## Configuration

### Centralized Configuration
The framework provides a centralized configuration system:

```javascript
const { IntegrationConfig } = require('./src/core/config/integration-config');

const config = IntegrationConfig.getInstance();

// Check if integration is enabled
if (config.isEnabled('mcp', 'notion')) {
  // Initialize Notion integration
}

// Get all enabled integrations
const enabled = config.getEnabledIntegrations();
console.log('Enabled:', enabled);
```

### Environment Variables
All integrations can be configured via environment variables:

```env
# MCP Integrations
NOTION_ENABLED=true
NOTION_API_KEY=your-key

# Databases
POSTGRES_ENABLED=true
POSTGRES_HOST=localhost
POSTGRES_DB=mydb

# DevOps
DOCKER_ENABLED=true
K8S_NAMESPACE=production

# External Services
SLACK_ENABLED=true
SLACK_BOT_TOKEN=xoxb-...
```

## Available Integrations

### 1. MCP Server Integrations (23+ modules)

#### Context MCP Server (NEW)
The Claude Context MCP Server provides advanced context management and preservation:

```javascript
const { ContextMCPIntegration } = require('./src/core/integrations/context-mcp-integration');

const context = new ContextMCPIntegration({
  maxContextSize: 200000, // tokens
  preservationStrategy: 'intelligent',
  autoSave: true
});

await context.initialize();

// Create and manage contexts
const ctxId = context.createContext('my-project', {
  type: 'project',
  metadata: { version: '1.0' }
});

// Add content to context
context.addToContext(ctxId, 'Important system information', {
  type: 'message',
  role: 'system'
});

// Search across all contexts
const results = context.searchContexts('important');

// Merge multiple contexts
const merged = context.mergeContexts(['ctx1', 'ctx2'], 'combined-context');

// Export for Claude
const exported = context.exportContext(ctxId, 'claude');
```

**Features:**
- 200K token context window
- Intelligent pruning to preserve important information
- Cross-session and multi-project support
- Searchable context history
- Compression and encryption options
- Auto-save and recovery
- Multiple export formats (JSON, Markdown, Claude)

#### Notion (22 modules)
- Master integration
- Workflow integration
- Dashboard builder
- Content generator
- Real-time progress indicators
- Department visibility widgets
- Cross-reference intelligence
- Dry-run system
- Manager certification workflows
- Timeline department structure
- Workstream templates
- Best practices

#### Figma (NEW)
```javascript
const figma = new FigmaIntegration();
await figma.initialize();

// Get file and components
const file = await figma.getFile('file-key');
const components = await figma.getFileComponents('file-key');

// Generate React component from Figma
const code = await figma.generateComponentCode('file-key', 'node-id', 'react');

// Sync design tokens
const tokens = await figma.syncDesignTokens('file-key');
```

### 2. Database Integrations (NEW)

#### PostgreSQL
```javascript
const postgres = new PostgresIntegration();
await postgres.initialize();

// Execute queries
const result = await postgres.query('SELECT * FROM users WHERE active = $1', [true]);

// Transactions
await postgres.transaction(async (client) => {
  await client.query('INSERT INTO logs (message) VALUES ($1)', ['Started']);
  await client.query('UPDATE users SET last_seen = NOW()');
});

// Batch operations
await postgres.batchInsert('users', ['name', 'email'], [
  ['Alice', 'alice@example.com'],
  ['Bob', 'bob@example.com']
]);
```

#### MongoDB
```javascript
const mongo = new MongoDBIntegration();
await mongo.initialize();

// CRUD operations
await mongo.insertOne('users', { name: 'Alice', age: 30 });
const users = await mongo.find('users', { age: { $gte: 18 } });
await mongo.updateMany('users', { active: false }, { $set: { active: true } });

// Aggregation
const pipeline = [
  { $match: { status: 'active' } },
  { $group: { _id: '$category', count: { $sum: 1 } } }
];
const results = await mongo.aggregate('products', pipeline);
```

#### Redis
```javascript
const redis = new RedisIntegration();
await redis.initialize();

// Cache operations
await redis.set('user:1', { name: 'Alice' }, 3600); // TTL 1 hour
const user = await redis.get('user:1');

// Advanced operations
await redis.incr('page_views');
await redis.lpush('queue', 'task1', 'task2');
await redis.sadd('tags', 'javascript', 'node');

// Pub/Sub
await redis.subscribe('notifications', (message) => {
  console.log('Received:', message);
});
await redis.publish('notifications', { type: 'alert', text: 'Hello' });
```

### 3. DevOps Integrations (NEW)

#### Docker
```javascript
const docker = new DockerIntegration();
await docker.initialize();

// Build and run containers
await docker.buildImage('my-app', {
  dockerfile: 'Dockerfile',
  buildArgs: { VERSION: '1.0.0' }
});

await docker.runContainer('my-container', 'my-app', {
  ports: { 3000: 3000 },
  env: { NODE_ENV: 'production' },
  volumes: ['./data:/app/data']
});

// Docker Compose
await docker.composeUp('docker-compose.yml');
await docker.composeDown('docker-compose.yml', { volumes: true });
```

#### Kubernetes
```javascript
const k8s = new KubernetesIntegration();
await k8s.initialize();

// Deploy applications
await k8s.createDeployment('my-app', {
  image: 'my-app:latest',
  replicas: 3,
  ports: [{ containerPort: 3000 }]
});

// Create services
await k8s.createService('my-app', {
  type: 'LoadBalancer',
  ports: [{ port: 80, targetPort: 3000 }]
});

// Manage deployments
await k8s.scaleDeployment('my-app', 5);
await k8s.updateDeployment('my-app', 'my-app:v2');
await k8s.rollbackDeployment('my-app');
```

### 4. Communication Services (NEW)

#### Slack
```javascript
const slack = new SlackIntegration();
await slack.initialize();

// Send messages
await slack.sendMessage('#general', 'Hello team!');

// Rich messages with blocks
const blocks = slack.createRichMessage('Deployment Status', [
  { type: 'text', content: 'ðŸ Deployment successful' },
  { type: 'fields', fields: [
    { title: 'Version', value: 'v1.2.3' },
    { title: 'Environment', value: 'Production' }
  ]}
]);
await slack.sendMessage('#deployments', 'Update', { blocks });
```

#### Discord
```javascript
const discord = new DiscordIntegration();
await discord.initialize();

// Send embed messages
const embed = discord.createEmbed(
  'System Status',
  'All systems operational',
  {
    color: 0x00ff00,
    fields: [
      { name: 'CPU', value: '45%' },
      { name: 'Memory', value: '2.3GB' }
    ]
  }
);
await discord.sendMessage(channelId, '', { embeds: [embed] });
```

### 5. AI/ML Services

#### OpenRouter (200+ models)
- Auto-routing to best model
- Cost optimization
- Model selection based on task

#### Pinecone
- Vector database operations
- Semantic search
- Embeddings storage

#### Kimi K2
- 200K context window
- Fast reasoning
- Code analysis

#### Serena (Enhanced)
- Semantic code search
- Code editing
- Workspace analysis

## Circuit Breaker & Resilience

The framework includes a comprehensive resilience system:

```javascript
const { MCPResilienceSystem } = require('./src/core/mcp/circuit-breaker');

const resilience = new MCPResilienceSystem();

// Execute with circuit breaker protection
const result = await resilience.executeWithCircuitBreaker(
  'notion-server',
  async () => {
    // Your operation
    return await notionAPI.getDatabase();
  },
  {
    threshold: 3,      // Trip after 3 failures
    timeout: 30000,    // 30s timeout
    resetTimeout: 60000 // Reset after 1 minute
  }
);

// Register fallback
resilience.registerFallback('notion-server', async () => {
  // Return cached or default data
  return getCachedData();
});

// Monitor circuit breaker status
const status = resilience.getAllStates();
console.log('Circuit breakers:', status);
```

### Features
- **Circuit Breaker Pattern**: Prevents cascading failures
- **Automatic Fallbacks**: Graceful degradation
- **Health Monitoring**: Continuous health checks
- **Retry Logic**: Exponential backoff
- **Statistics Tracking**: Performance metrics

## Testing

Run the comprehensive test suite:

```bash
# Run all integration tests
npm test tests/integration/integration-systems.test.js

# Run specific category tests
npm test -- --testNamePattern="Figma Integration"
npm test -- --testNamePattern="Database Integrations"
npm test -- --testNamePattern="Circuit Breaker"
```

### Test Coverage
- Configuration system validation
- Circuit breaker functionality
- All integration initializations
- Mock operations for databases
- Metric tracking verification

## Troubleshooting

### Common Issues

#### Integration Not Loading
```javascript
// Check if enabled
const config = IntegrationConfig.getInstance();
console.log('Enabled?', config.isEnabled('mcp', 'notion'));

// Check credentials
console.log('Has key?', !!process.env.NOTION_API_KEY);
```

#### Circuit Breaker Tripping
```javascript
// Check circuit breaker state
const state = resilience.getCircuitBreaker('server-name').getState();
console.log('State:', state);

// Reset if needed
resilience.resetCircuitBreaker('server-name');
```

#### Database Connection Issues
```javascript
// Test connection
const postgres = new PostgresIntegration();
const initialized = await postgres.initialize();
console.log('Connected:', initialized);

// Check status
console.log('Status:', postgres.getStatus());
```

### Debug Mode
Enable detailed logging:

```env
LOG_LEVEL=debug
ENABLE_METRICS=true
ENABLE_HEALTH_CHECKS=true
```

## Best Practices

1. **Always use environment variables** for credentials
2. **Enable circuit breakers** for external services
3. **Implement fallbacks** for critical operations
4. **Monitor metrics** to detect issues early
5. **Use connection pooling** for databases
6. **Cache frequently accessed data** with Redis
7. **Batch operations** when possible
8. **Test integrations** before production

## Performance Tips

### Database Optimization
- Use connection pooling
- Batch inserts for bulk data
- Create appropriate indexes
- Use Redis for caching

### API Rate Limiting
- Implement request queuing
- Use circuit breakers
- Cache API responses
- Monitor rate limits

### Resource Management
```javascript
// Clean up connections
process.on('SIGTERM', async () => {
  await postgres.close();
  await mongo.close();
  await redis.close();
  process.exit(0);
});
```

## Migration from v1

If upgrading from previous versions:

1. Update environment variables to new format
2. Replace old integration imports with new paths
3. Update configuration to use IntegrationConfig
4. Add circuit breaker protection to critical paths

---

## Summary

The BUMBA Integration Systems provide:
- **71+ integration files** ready to use (including new Context MCP)
- **Context MCP Server** for advanced context preservation
- **22 Notion modules** for comprehensive project management
- **3 database systems** with full CRUD operations
- **2 DevOps platforms** for container orchestration
- **2 communication services** for team collaboration
- **Circuit breaker protection** for all external calls
- **Centralized configuration** management
- **Comprehensive testing** suite with 120+ tests

All integrations are production-ready with proper error handling, metrics tracking, and fallback mechanisms.

### Key Context MCP Features:
- **200K token context window** for large conversations
- **Intelligent pruning** preserves important information
- **Cross-session support** maintains context between Claude sessions
- **Multi-project management** organize contexts by project
- **Searchable history** find information across all contexts
- **Auto-save & recovery** never lose important context
- **Export formats** JSON, Markdown, Claude-optimized XML

---

*Last Updated: 2025-08-16*  
*Framework Version: BUMBA v1.0*  
*Total Integrations: 59+*